# 开发指南

本文档面向不同角色的开发者，提供详细的开发指导。

## 👨‍💻 前端开发者

### 代码规范

- **TypeScript**：所有代码使用 TypeScript，类型定义完整
- **组件命名**：使用 PascalCase（如 `GoodsCard.vue`）
- **函数命名**：使用 camelCase（如 `handleCardClick`）
- **常量命名**：使用 UPPER_SNAKE_CASE（如 `MAX_PAGE_SIZE`）

### 开发流程

#### 1. 新增功能

1. **API 接口封装**：在 `src/api/` 中定义接口封装
2. **创建组件**：在 `src/components/` 中创建可复用组件
3. **创建页面**：在 `src/views/` 中创建业务页面
4. **状态管理**：在 `src/stores/` 中管理状态（如需要）

#### 2. 对接后端接口

1. 参考 `src/api/*` 中的接口封装方式
2. 在 `src/api/types.ts` 中添加类型定义
3. 注意处理错误场景（429 限流、409 冲突等）

#### 3. 样式调整

- **主题变量**：在 `src/styles/variables.css` 中
- **Element Plus 主题**：在 `src/styles/element-plus-theme.css` 中
- **组件样式**：使用 scoped CSS

#### 4. 移动端适配

- 使用响应式设计（CSS 媒体查询）
- PC 端表格展示，移动端卡片展示
- 测试不同屏幕尺寸下的交互体验

### 注意事项

- ⚠️ **防抖处理**：搜索功能需使用防抖（如 `lodash-es` 的 `debounce`）
- ⚠️ **错误处理**：API 调用需处理错误场景，提供友好的用户提示
- ⚠️ **性能优化**：避免不必要的重复请求，使用缓存机制
- ⚠️ **类型安全**：所有 API 调用需使用 TypeScript 类型定义

## 🔧 后端开发者

### 接口规范

- **返回格式**：列表接口返回分页格式（`count`、`next`、`previous`、`results`）
- **错误处理**：使用标准 HTTP 状态码（400、404、409、429、500 等）
- **分页参数**：`page`（页码，从 1 开始）、`page_size`（每页数量，默认 20）
- **图片上传**：主图上传接口 `/api/goods/{id}/upload-main-photo/` 使用 FormData

### 注意事项

- ⚠️ **限流阈值**：如限流阈值变化，需同步前端（目前默认 60 次/分钟）
- ⚠️ **字段变更**：API 字段变更时，需同步更新前端 `src/api/types.ts`
- ⚠️ **跨域配置**：开发环境下前端通过代理访问，生产环境需配置 CORS

## 🧪 测试人员

### 测试范围

#### 1. 核心流程

- 检索、筛选、分页
- 资产录入、编辑、删除
- 位置树增删改
- IP/角色/品类管理
- BGM 导入流程

#### 2. 异常场景

- 429 限流（快速搜索触发限流）
- 409 冲突（重复创建）
- 404 未找到（BGM 搜索无结果）
- 网络错误（断网、超时）

#### 3. 移动端适配

- 不同屏幕尺寸下的交互体验
- 响应式布局是否正常
- 触摸操作是否流畅

#### 4. 边界情况

- 空数据展示
- 大量数据加载（分页是否正常）
- 特殊字符输入（XSS 防护）
- BGM 搜索结果为空

## 🎨 产品/设计

### 主题调整

- **主题变量**：`src/styles/variables.css` 中的 CSS 变量
- **Element Plus 主题**：`src/styles/element-plus-theme.css` 中的组件样式

### 交互调整

- **组件样式**：在组件中直接修改（使用 scoped CSS）
- **布局调整**：在 `src/components/Layout.vue` 中调整
- **新增页面**：参考现有页面的布局和交互模式

## 📊 性能指标

| 指标 | 目标 | 说明 |
|------|------|------|
| **首屏加载** | ≤ 1.5s | 内网环境，位置树 + 首屏列表 |
| **搜索响应** | ≤ 300ms | 防抖延迟 + API 响应时间 |
| **页面切换** | ≤ 500ms | 路由切换 + 数据加载 |
| **图片加载** | 懒加载 | 滚动时加载图片，优化首屏性能 |

## 🧪 测试

### 单元测试

```bash
# 运行单元测试
pnpm test:unit

# 监听模式
pnpm test:unit --watch
```

测试框架：**Vitest**，测试文件位于 `src/__tests__/` 目录。

### 代码质量检查

```bash
# TypeScript 类型检查
pnpm type-check

# ESLint 代码检查与自动修复
pnpm lint
```

## 📝 开发状态

### ✅ 已完成功能

| 功能模块 | 状态 | 说明 |
|---------|------|------|
| **真实数据接入** | ✅ | 已按照后端接口规范完成对接 |
| **图片上传** | ✅ | 主图上传、角色头像上传已实现 |
| **补充图片管理** | ✅ | 补充图片上传、删除、标签管理完整功能 |
| **图片裁剪功能** | ✅ | 支持图片上传前裁剪，支持多种裁剪比例（1:1、4:3、16:9等） |
| **原生相机集成** | ✅ | 移动端支持调用原生相机拍照，自动集成到图片上传流程 |
| **IP 与角色管理** | ✅ | 统一页面，支持展开/折叠查看角色列表 |
| **BGM 导入功能** | ✅ | 完整的 Bangumi 数据导入流程 |
| **品类管理** | ✅ | 独立页面，支持完整 CRUD 操作 |
| **右键快捷操作** | ✅ | 云展柜页面支持右键菜单编辑/删除 |
| **移动端适配** | ✅ | 响应式导航栏、折叠菜单、卡片式布局、底部导航栏 |
| **移动端手势优化** | ✅ | 详情抽屉拖拽手势、半屏/全屏切换 |
| **路由标题管理** | ✅ | 路由切换时自动更新页面标题 |
| **错误处理** | ✅ | 429 限流、409 冲突、404 未找到等友好提示 |

### 🔄 待完善功能

| 功能模块 | 优先级 | 说明 |
|---------|--------|------|
| **认证与权限** | 🔴 高 | 如需多用户，需补登录/Token/权限控制 |
| **数据统计** | 🟡 中 | 资产价值、占比、时间分布等图表未实现 |
| **性能优化** | 🟢 低 | 大量数据时可考虑虚拟滚动优化 |
